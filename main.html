
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Konnect</title>
<link rel="stylesheet" href="style.css">

<!-- Firebase SDKs -->
<script type="module">
  // Import the functions you need from the SDKs
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAPvMmKigTlnSgi3qu7jwtRiFMAXJtxpHg",
    authDomain: "konnect-38667.firebaseapp.com",
    projectId: "konnect-38667",
    storageBucket: "konnect-38667.appspot.com",
    messagingSenderId: "687825094848",
    appId: "1:687825094848:web:7af16061a55d118a3f8525"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.db = db; // make accessible globally
</script>

<style>
/* Basic Styles */
body { margin:0; font-family:"Helvetica Neue", Arial, sans-serif; background:#f0f0f0; }
.header { background:#004aad; color:#fff; padding:14px; display:flex; justify-content:space-between; align-items:center; }
.header h1 { margin:0; font-size:22px; }
.header button { font-size:26px; background:none; border:none; color:#fff; cursor:pointer; }

.search-box { padding:10px; background:#fff; }
.search-box input { width:100%; padding:10px; border-radius:20px; border:1px solid #ccc; outline:none; }

#newContactBox { display:none; padding:10px; background:#fff; border-bottom:1px solid #ddd; }
#newContactBox input { width:100%; padding:10px; margin-bottom:8px; border-radius:6px; border:1px solid #ccc; }
#newContactBox button { width:100%; padding:10px; background:#004aad; color:#fff; border:none; border-radius:6px; }

.chat-list { padding:8px; }
.chat { background:#fff; padding:10px; border-radius:8px; display:flex; align-items:center; margin-bottom:8px; cursor:pointer; }
.chat img { width:48px; height:48px; border-radius:50%; margin-right:10px; }
.chat h3 { margin:0; font-size:16px; }
.chat p { margin:2px 0 0; font-size:13px; color:gray; }
.empty-message { text-align:center; color:gray; margin-top:50px; font-size:16px; }
</style>

</head>
<body>

<div class="header">
  <h1>Konnect</h1>
  <button onclick="toggleNewContact()">ï¼‹</button>
</div>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Search or start new chat" oninput="filterChats()">
</div>

<div id="newContactBox">
  <input id="newNumber" placeholder="Phone number">
  <input id="newName" placeholder="Contact name">
  <button onclick="addContact()">Save Contact</button>
</div>

<div id="chatList" class="chat-list"></div>
<div id="emptyMessage" class="empty-message">No chats yet. Tap + to start a chat.</div>

<script type="module">
const db = window.db;
let chats = [];

function toggleNewContact() {
  const box = document.getElementById("newContactBox");
  box.style.display = box.style.display === "block" ? "none" : "block";
}

async function addContact() {
  const number = document.getElementById("newNumber").value.trim();
  const name = document.getElementById("newName").value.trim();
  if (!number || !name) {
    alert("Enter both name and number");
    return;
  }

  // Save chat to Firebase
  try {
    await addDoc(collection(db, "chats"), {
      members: [number],  // For now, single-member demo
      name: name,
      createdAt: new Date()
    });
  } catch(e) { console.error(e); }

  document.getElementById("newNumber").value = "";
  document.getElementById("newName").value = "";
  document.getElementById("newContactBox").style.display = "none";
}

function renderChats(list) {
  const chatList = document.getElementById("chatList");
  chatList.innerHTML = "";
  if (list.length === 0) {
    document.getElementById("emptyMessage").style.display = "block";
    return;
  } else {
    document.getElementById("emptyMessage").style.display = "none";
  }

  list.forEach(c => {
    const div = document.createElement("div");
    div.className = "chat";
    div.innerHTML = `
      <img src="https://via.placeholder.com/48">
      <div>
        <h3>${c.name}</h3>
        <p>${c.members.join(", ")}</p>
      </div>
    `;
    div.onclick = () => {
      localStorage.setItem("activeChat", c.id);
      // Here you would navigate to chat.html to open messages
      alert(`Opening chat with ${c.name}`);
    };
    chatList.appendChild(div);
  });
}

// Load chats from Firebase in real-time
const q = query(collection(db, "chats"), orderBy("createdAt"));
onSnapshot(q, (snapshot) => {
  chats = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderChats(chats);
});

// Filter chats on search
function filterChats() {
  const q = document.getElementById("searchInput").value.toLowerCase();
  const filtered = chats.filter(c =>
    c.name.toLowerCase().includes(q) || c.members.join(", ").includes(q)
  );
  renderChats(filtered);
}
</script>

</body>
</html>
